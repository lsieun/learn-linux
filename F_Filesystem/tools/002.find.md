# find

<!-- TOC -->

- [1. 文件名查找](#1-%e6%96%87%e4%bb%b6%e5%90%8d%e6%9f%a5%e6%89%be)
- [2. 文件类型查找](#2-%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%e6%9f%a5%e6%89%be)
- [3. 逻辑（或、非）查询](#3-%e9%80%bb%e8%be%91%e6%88%96%e9%9d%9e%e6%9f%a5%e8%af%a2)
- [4. 按时间查询](#4-%e6%8c%89%e6%97%b6%e9%97%b4%e6%9f%a5%e8%af%a2)
- [5. 根据属主和属组查询](#5-%e6%a0%b9%e6%8d%ae%e5%b1%9e%e4%b8%bb%e5%92%8c%e5%b1%9e%e7%bb%84%e6%9f%a5%e8%af%a2)
  - [5.1. 用户名和用户组查询](#51-%e7%94%a8%e6%88%b7%e5%90%8d%e5%92%8c%e7%94%a8%e6%88%b7%e7%bb%84%e6%9f%a5%e8%af%a2)
  - [5.2. 用户ID和用户组ID查询](#52-%e7%94%a8%e6%88%b7id%e5%92%8c%e7%94%a8%e6%88%b7%e7%bb%84id%e6%9f%a5%e8%af%a2)
- [6. 根据文件大小查询](#6-%e6%a0%b9%e6%8d%ae%e6%96%87%e4%bb%b6%e5%a4%a7%e5%b0%8f%e6%9f%a5%e8%af%a2)
- [7. Examples](#7-examples)
- [8. find and copy](#8-find-and-copy)
- [9. Another example: Find and move](#9-another-example-find-and-move)

<!-- /TOC -->

查找：

- 文件名
- 文件类型
- 逻辑（或、非）：文件名、文件类型
- 时间：访问时间（文件内容）、修改时间（文件内容）、改变时间（元数据：文件名、文件大小、权限等）
- 用户和用户组
- 文件大小

## 1. 文件名查找

按**文件名**查找，默认查找「当前目录及其子目录」，命令如下：

```bash
cd /usr
find -name bash           # 查找特定的文件名
find -name bash*          # 在当前目录查找
find /tmp -name a*        # 在/tmp目录查找
```

## 2. 文件类型查找

按**文件类型**查找，命令如下：

```bash
find . -type f    # To find all files in a location
find . -type d    # To find all directories in a location
```

## 3. 逻辑（或、非）查询

使用逻辑“或”、“非”

```bash
find /tmp -name "a*" -o -name "b*"     # 查找以a开头或b开头的文件或目录（逻辑“或”）
find /tmp -name "a*" ! -type f         # 查找以a开头的非文件（逻辑“非”）
```

注意，默认情况下就是“且”，例如：

```bash
find /tmp -name "a*" -type f           # 查找以a开头的文件（注意：类型是文件）
find /tmp -name "a*" -type s           # 查找以a开头的套接字
```

## 4. 按时间查询

Hi, Hi, Hi!!!`find`命令可以根据三种访问时间来查找

| 命令选项   | 时间类型 | 时间单位   | 命令说明                                     |
| ---------- | -------- | ---------- | -------------------------------------------- |
| `-amin n`  | Access   | `n`分钟    | 查找系统中最后`n`分钟访问的文件              |
| `-atime n` | Access   | `n*24`小时 | 查找系统中最后`n*24`小时访问的文件           |
| `-mmin n`  | Modify   | `n`分钟    | 查找系统中最后`n`分钟被改变文件数据的文件    |
| `-mtime n` | Modify   | `n*24`小时 | 查找系统中最后`n*24`小时被改变文件数据的文件 |
| `-cmin n`  | Change   | `n`分钟    | 查找系统中最后`n`分钟被改变文件状态的文件    |
| `-ctime n` | Change   | `n*24`小时 | 查找系统中最后`n*24`小时被改变文件状态的文件 |

同时要注意：`+n`和`-n`的区别。例如

- 使用 `-amin +5`表示5分钟之前访问的文件
- 使用 `-amin -5` 表示5分钟以内访问的文件

## 5. 根据属主和属组查询

### 5.1. 用户名和用户组查询

直接根据用户名和用户组进行查询：

```bash
find /home -user liusen    # 根据用户进行查询
find /home -group tomcat   # 根据属组进行查询
```

### 5.2. 用户ID和用户组ID查询

查询用户ID：

```bash
$ id    # 查询当前用户ID
uid=1000(liusen) gid=1000(liusen) groups=1000(liusen),10(wheel),977(vboxusers)

$ id liusen    # 查询指定用户名的ID
uid=1000(liusen) gid=1000(liusen) groups=1000(liusen),10(wheel),977(vboxusers)

$ id root
uid=0(root) gid=0(root) groups=0(root)
```

根据用户ID和用户组ID查询：

```bash
find ./ -uid 1000
find ./ -gid 1000
```

## 6. 根据文件大小查询

```bash
find /home -empty         # 查找空文件或文件夹
find /home ! -empty       # 查找不空的文件或文件夹

find /home -size -512k    # 查找小于512k的文件
find /home -size +512k    # 查找大于512k的文件夹
```

关于`-size`选项：

```txt
-size n[cwbkMG]
```

File uses `n` units of space, rounding up.  The following suffixes can be used:

- `b`: for 512-byte blocks (this is the default if no suffix is used)
- `c`: for bytes
- `w`: for two-byte words
- `k`: for Kilobytes (units of 1024 bytes)
- `M`: for Megabytes (units of 1048576 bytes)
- `G`: for Gigabytes (units of 1073741824 bytes)

More Example: 拿着`find`命令到处敲敲打打

```bash
find /home -size -25k ! -empty
find /home -size -25k ! -empty -type f
```

## 7. Examples

Count

```bash
find . -type f | wc -l    # To find the number of files in a location
find . -type f | grep "jpg" | wc -l    # To find the number of "jpg" files in a location
```

To find files of size between 1 MB and 2 MB in a location:

```bash
find . -type f -size +1M -size -2M
```

copy all files of size between 1 and 2 MB to another location

```bash
find . -type f -size +1M -size -2M -exec cp {} ~/my_files/ \;
```

Here `{}` contains the results of the `find`. The last `;` is also required and **has to be escaped**.

## 8. find and copy

Actually, in two ways you can process `find` command output in `copy` command

If `find` command's output **doesn't contain any space** i.e if file name doesn't contain space in it then you can use below mentioned command:

Syntax: `find <Path> <Conditions> | xargs cp -t <copy file path>`

Example: `find -mtime -1 -type f | xargs cp -t inner/`

But most of the time our production data files **might contain space** in it. So most of time below mentioned command is safer:

Syntax: `find <path> <condition> -exec cp '{}' <copy path> \;`

Example: `find -mtime -1 -type f -exec cp '{}' inner/ \;`

In the second example, last part i.e **semi-colon** is also considered as part of `find` command, that **should be escaped** before press the **enter** button. Otherwise you will get an error something like this

```txt
find: missing argument to `-exec'
```

举例子说明

Run the following command to find and copy all files that matches with extension `.mp3`.

```bash
find -iname '*.mp3' -exec cp {} /home/sk/test2/ \;
```

Let us break down the above command and see what each option does.

- `find` – It’s the command to find files and folders in Unix-like systems.
- `-iname '*.mp3'` – Search for files matching with extension `.mp3`.
- `-exec cp` – Tells you to execute the ‘cp’ command to copy files from source to destination directory.
- `{}` – is automatically replaced with the file name of the files found by ‘find’ command.
- `/home/sk/test2/` – Target directory to save the matching files.
- `\;` – Indicates it that the commands to be executed are now complete, and to carry out the command again on the next match.

```bash
find . -type f -name "*.mp3" -exec cp {} /tmp/MusicFiles \;
```

If you're familiar with the `find` command and have used the `-exec` option before, the only thing hard about this command is knowing where to put **the curly braces** and the `\;` in the command.

A few points:

- In this example, all the MP3 files beneath the current directory are copied into the target directory (`/tmp/MusicFiles`). Again, this isn't a `cp -r` command; all of these files will end up in one folder.
- As a result, **if there are duplicate file names, some of the files will be lost**.
- If you don’t want to overwrite existing files, use the `cp -n` command, like this:

```bash
find . -type f -name "*.mp3" -exec cp -n {} /tmp/MusicFiles \;
```

The `-n` option of the `cp` command means “**no clobber**,” and you can also type that as `cp --no-clobber` on some systems, such as Linux. (The `-n` option appears to work on MacOS systems, but `--no-clobber` does not.) **Be sure to test this command before using it on something important**; I haven’t tested it yet, I just read the man page for the `cp` command.)

## 9. Another example: Find and move

Here’s another example of a “find and copy” command I just used, though in this case it was a “**find and move**” command. In this case I had a bunch of files (with unique names) in subdirectories, and used this command to copy them all to the current directory:

```bash
find . -type f -exec mv {} . \;
```

As before, this is a dangerous command, so be careful. With this command, if you have **duplicate filenames**, you will **definitely lose data** during the move operations.
